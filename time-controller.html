<script type="text/javascript">
    RED.nodes.registerType('time-controller', {
        category: 'function',
        color: '#a6bbcf',
        defaults: {
            data: {
                value: "{}",
                validate: RED.validators.typedInput("dataType"),
                required: true
            },
            dataType: {
                value: "json"
            },
            interval: {
                value: 1,
                required: true
            },
            lat: {
                value: ''
            },
            lon: {
                value: ''
            },
            usePreviousEventOnReload: {
                value: true
            },
        },
        inputs: 1,
        outputs: 1,
        icon: "file.png",
        label: function () {
            return this.name || "time-controller";
        },
        oneditprepare: function () {
            var node = this;
            if (
                !$('#node-input-lat')
                .val()
                .trim() &&
                !$('#node-input-lon')
                .val()
                .trim()
            ) {
                if ('geolocation' in navigator) {
                    navigator.geolocation.getCurrentPosition(function (position) {
                        $('#node-input-lat').val(Number(position.coords.latitude.toFixed(5)));
                        $('#node-input-lon').val(Number(position.coords.longitude.toFixed(5)));
                    });
                }
            }

            $("#node-input-data").typedInput({
                default: 'json',
                types: ['json']
            });

        }
    });
</script>

<script type="text/x-red" data-template-name="time-controller">
    <div class="form-row">
        <label for="node-input-data"><i class="fa fa-envelope"></i> Data</label>
        <input type="text" id="node-input-data" placeholder="{}"></input>
      </div>
    <div class="form-row">
    	<label for="node-input-interval"><i class="fa fa-tasks"></i> interval</label>
    	<input type="text" id="node-input-interval" placeholder="1">
    </div>
    <div class="form-row">
    	<label for="node-input-lat"><i class="fa fa-globe"></i> Latitude</label>
    	<input type="text" id="node-input-lat" placeholder="51.025">
    </div>
    <div class="form-row">
    	<label for="node-input-lon"><i class="fa fa-globe"></i> Longitude</label>
    	<input type="text" id="node-input-lon" placeholder="-1.4">
    </div>
    </div>
    <div class="form-row">
        <label style="margin-left: 100px; width: 70%">
            <input type="checkbox" id="node-input-usePreviousEventOnReload" placeholder="" style="width: 20px; margin: 0">
            Use previous state of event on reload
        </label>
    </div>
</script>

<script type="text/x-red" data-help-name="time-controller">
    <pre>
[{
    "start": {
        "time": "16:00",
        "value": 0,
        "offset": 0
    },
    "end": {
        "time": "17:00",
        "value": 100,
        "offset": 30
    },
    "topic": "rgbw/cmnd/channel1"
}]
    </pre>
</script>